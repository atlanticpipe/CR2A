# =====================================================================
# APS Contract Analysis — Rulebook v1 (human-readable, with comments)
# Location: contract-analysis-policy-bundle/policy/rulebook_v1.yaml
# Purpose: Single source of truth replacing the 35 prompt chain.
# At runtime we’ll convert this YAML to a strict JSON (no comments).
# =====================================================================

meta:
  version: "1.0"                # Rulebook version tag (bump when semantics change)
  schema_version: "1.0"         # Output/API schema version this rulebook targets
  owner: "Atlantic Pipe Services (APS)"  # Logical owner for audits
  description: >                # Short description for humans/audit logs
    Consolidated contract-analysis policy. Encodes template headers, execution
    rules, redlining references, FDOT handling, and validation behaviors.

artifacts:
  template_doc_id: "file-VGX1xeDCCyzzNhiWKtivrU"   # Clause Risk & Compliance Summary Template
  redline_guidelines_doc_id: "file-SuN86exJDKidXCm3D1xZuX"  # Redlining Guidelines (Volume 4)

controls:
  # Global toggles that the orchestrator reads at startup.
  strict_header_match: true      # Abort if any section/header text deviates
  fail_fast: true                # Stop the run on first validation breach
  emit_provenance: true          # Include source/page/span for each clause
  bluf_enabled: true             # Allow BLUF notes where rules permit

fdot:
  # FDOT handling policy — we’ll wire detectors later; this locks the behavior.
  permit_fdot_contracts: true
  require_year_lock_before_analysis: true     # If true, abort unless fdot_year is known
  substitution_rule: "contract_silent_or_weaker->insert_fdot_text"  # Replacement policy
  allowed_years: [ "2022", "2023", "2024", "2025" ]  # Guardrail list; can expand later

sections:
  # Canonical, locked headers in the exact order. These replace ad-hoc prompts.
  # SECTION I — Contract Overview (fixed 8 fields)
  I:
    type: "overview"
    headers_locked: true
    fields_ordered:                      # Must be exactly these keys in this order
      - "PROJECT TITLE:"
      - "SOLICITATION NO.:"
      - "OWNER:"
      - "CONTRACTOR:"
      - "SCOPE:"
      - "GENERAL RISK LEVEL:"
      - "BID MODEL:"
      - "NOTES:"

  # SECTION II — Administrative & Commercial Terms (16 items)
  II:
    type: "clauses"
    headers_locked: true
    items:
      - "Contract Term, Renewal & Extensions"
      - "Bonding, Surety, & Insurance Obligations"
      - "Retainage, Progress Payments & Final Payment Terms"
      - "Pay-When-Paid, Pay-If-Paid, or Owner Payment Contingencies"
      - "Price Escalation Clauses (Labor, Materials, Fuel, Inflation Adjustments)"
      - "Fuel Price Adjustment / Fuel Cost Caps"
      - "Change Orders, Scope Adjustments & Modifications"
      - "Termination for Convenience (Owner/Agency Right to Terminate Without Cause)"
      - "Termination for Cause / Default by Contractor"
      - "Bid Protest Procedures & Claims of Improper Award"
      - "Bid Tabulation, Competition & Award Process Requirements"
      - "Contractor Qualification, Licensing & Certification Requirements"
      - "Release Orders, Task Orders & Work Authorization Protocols"
      - "Assignment & Novation Restrictions (Transfer of Contract Rights)"
      - "Audit Rights, Recordkeeping & Document Retention Obligations"
      - "Notice Requirements & Claim Timeframes (Notice to Cure, Delay Notices, Termination Notices, etc.)"

  # SECTION III — Technical & Performance Terms (17 items)
  III:
    type: "clauses"
    headers_locked: true
    items:
      - "Scope of Work (Work Inclusions, Exclusions & Defined Deliverables)"
      - "Performance Schedule, Time for Completion & Critical Path Obligations"
      - "Delays of Any Kind (Force Majeure, Acts of God, Weather, Owner-Caused, Unforeseen Events)"
      - "Suspension of Work, Work Stoppages & Agency Directives"
      - "Submittals, Documentation & Approval Requirements"
      - "Emergency & Contingency Work Obligations"
      - "Permits, Licensing & Regulatory Approvals for Work"
      - "Warranty, Guarantee & Defects Liability Periods"
      - "Use of APS Tools, Equipment, Materials or Supplies"
      - "Owner-Supplied Support, Utilities & Site Access Provisions"
      - "Field Ticket, Daily Work Log & Documentation Requirements"
      - "Mobilization & Demobilization Provisions"
      - "Utility Coordination, Locate Risk & Conflict Avoidance"
      - "Delivery Deadlines, Milestone Dates, Substantial & Final Completion Standards"
      - "Punch List, Closeout Procedures & Acceptance of Work"
      - "Worksite Coordination, Access Restrictions & Sequencing Obligations"
      - "Deliverables, Digital Submissions & Documentation Standards"

  # SECTION IV — Legal Risk & Enforcement (13 items)
  IV:
    type: "clauses"
    headers_locked: true
    items:
      - "Indemnification, Defense & Hold Harmless Provisions"
      - "Duty to Defend vs. Indemnify Scope Clarifications"
      - "Limitations of Liability, Damage Caps & Waivers of Consequential Damages"
      - "Insurance Coverage, Additional Insured & Waiver of Subrogation Clauses"
      - "Dispute Resolution (Mediation, Arbitration, Litigation)"
      - "Flow-Down Clauses (Prime-to-Subcontract Risk Pass-Through)"
      - "Subcontracting Restrictions, Approval & Substitution Requirements"
      - "Background Screening, Security Clearance & Worker Eligibility Requirements"
      - "Safety Standards, OSHA Compliance & Site-Specific Safety Obligations"
      - "Site Conditions, Differing Site Conditions & Changed Circumstances Clauses"
      - "Environmental Hazards, Waste Disposal & Hazardous Materials Provisions"
      - "Conflicting Documents / Order of Precedence Clauses"
      - "Setoff & Withholding Rights (Owner’s Right to Deduct or Withhold Payment)"

  # SECTION V — Regulatory & Compliance Terms (8 items)
  V:
    type: "clauses"
    headers_locked: true
    items:
      - "Certified Payroll, Recordkeeping & Reporting Obligations"
      - "Prevailing Wage, Davis-Bacon & Federal/State Wage Compliance"
      - "EEO, Non-Discrimination, MWBE/DBE Participation Requirements"
      - "Anti-Lobbying / Cone of Silence Provisions"
      - "Apprenticeship, Training & Workforce Development Requirements"
      - "Immigration / E-Verify Compliance Obligations"
      - "Worker Classification & Independent Contractor Restrictions"
      - "Drug-Free Workplace Programs & Substance Testing Requirements"

  # SECTION VI — Data, Technology & Deliverables (7 items)
  VI:
    type: "clauses"
    headers_locked: true
    items:
      - "Data Ownership, Access & Rights to Digital Deliverables"
      - "AI / Technology Use Restrictions (Automation, Digital Tools, Proprietary Systems)"
      - "Digital Surveillance, GIS-Tagged Deliverables & Monitoring Requirements"
      - "GIS, Digital Workflow Integration & Electronic Submittals"
      - "Confidentiality, Data Security & Records Retention Obligations"
      - "Intellectual Property, Licensing & Ownership of Work Product"
      - "Cybersecurity Standards, Breach Notification & IT System Use Policies"

  # SECTION VII — Supplemental Operational Risks (grouped items; count is dynamic)
  VII:
    type: "supplemental"
    headers_locked: true
    grouping_rules: "Only risks not classifiable under Sections II–VI; grouped by common scope."

  # SECTION VIII — Risk Summary (table + general level)
  VIII:
    type: "summary"
    headers_locked: true
    table_columns: [ "Risk Area", "Risk Summary", "Redline Recommendation Summary" ]
    include_general_risk_level: true

output_rules:
  # Output formatting and gating rules (from your 35 prompts), summarized.
  clause_block_order: [ "Clause Language", "Clause Summary", "Risk Triggers Identified", "Flow-Down Obligations", "Redline Recommendations", "Harmful Language / Policy Conflicts" ]
  require_closing_line: "All applicable clauses for [Item #/Title] have been identified and analyzed."
  redline_reference: "Use Redlining Guidelines exactly; no deviation."
  bluf_examples:
    - "BLUF: No clause present in contract/spec. Verified across full text and cross-references."
    - "BLUF: Clause identified but belongs under Section III, Item 3 (Delays). Not included here."

validation:
  # Hard stops to prevent drift.
  abort_if_template_not_loaded: true
  abort_if_redline_not_available: true
  abort_on_header_mismatch: true
  mandatory_fields_section_I: 8      # Enforce all eight overview fields
