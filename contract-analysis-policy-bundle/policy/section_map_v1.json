{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Clause Risk & Compliance Summary — Filled Template (v1)",
  "description": "Schema aligned to the DOCX template (Sections I–VIII). Strict mode is expected.",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "version": { "type": "string", "const": "v1" },
    "doc_meta": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "title": { "type": "string" },
        "source_file": { "type": "string" },
        "policy_version": { "type": "string" },
        "created_at": { "type": "string", "format": "date-time" }
      }
    },

    "SECTION_I": {
      "type": "object",
      "description": "Contract Overview fields (from template Section I).",
      "additionalProperties": false,
      "properties": {
        "Project Title:": { "type": "string" },
        "Solicitation No.:": { "type": "string" },
        "Owner:": { "type": "string" },
        "Contractor:": { "type": "string" },
        "Scope:": { "type": "string" },
        "General Risk Level:": { "type": "string" },
        "Bid Model:": { "type": "string" },
        "Notes:": { "type": "string" }
      },
      "required": [
        "Project Title:",
        "Solicitation No.:",
        "Owner:",
        "Contractor:",
        "Scope:",
        "General Risk Level:",
        "Bid Model:",
        "Notes:"
      ]
    },

    "SECTION_II": { "$ref": "#/$defs/SectionItems" },
    "SECTION_III": { "$ref": "#/$defs/SectionItems" },
    "SECTION_IV": { "$ref": "#/$defs/SectionItems" },
    "SECTION_V": { "$ref": "#/$defs/SectionItems" },
    "SECTION_VI": { "$ref": "#/$defs/SectionItems" },

    "SECTION_VII": {
      "type": "array",
      "description": "Supplemental Operational Risks — freeform items using the same ClauseBlock structure.",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "item_number": { "type": "integer", "minimum": 1 },
          "item_title": { "type": "string" },
          "clauses": { "$ref": "#/$defs/ClauseBlockArray" },
          "closing_line": { "type": "string", "pattern": "^All applicable clauses for .+ have been identified and analyzed\.$" }
        },
        "required": ["item_number", "item_title", "clauses", "closing_line"]
      }
    },

    "SECTION_VIII": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Final Assessment": { "type": "string" },
        "Key Risks Summary": { "type": "string" },
        "Overall Recommendation": { "type": "string" }
      }
    }
  },

  "required": ["SECTION_I", "SECTION_II", "SECTION_III", "SECTION_IV", "SECTION_V", "SECTION_VI"],

  "$defs": {
    "ClauseBlockArray": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/ClauseBlock" }
    },

    "ClauseBlock": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "clause_language": { "type": "string" },
        "clause_summary": { "type": "string" },
        "risk_triggers": {
          "oneOf": [
            { "type": "string" },
            { "type": "array", "items": { "type": "string" } }
          ]
        },
        "flow_down_obligations": { "type": "string" },
        "redline_recommendations": { "type": "string" },
        "harmful_language_conflicts": { "type": "string" },
        "citation": { "type": "string" },
        "provenance": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "source": { "type": "string" },
            "page": { "type": "integer", "minimum": 1 },
            "span": { "type": "string" }
          },
          "required": ["source", "page", "span"]
        }
      },
      "required": [
        "clause_language",
        "clause_summary",
        "risk_triggers",
        "flow_down_obligations",
        "redline_recommendations",
        "harmful_language_conflicts",
        "provenance"
      ]
    },

    "SectionItems": {
      "type": "array",
      "description": "Template-driven items for a section.",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "item_number": { "type": "integer", "minimum": 1 },
          "item_title": { "type": "string" },
          "clauses": { "$ref": "#/$defs/ClauseBlockArray" },
          "closing_line": { "type": "string", "pattern": "^All applicable clauses for .+ have been identified and analyzed\.$" }
        },
        "required": ["item_number", "item_title", "clauses", "closing_line"]
      }
    }
  }
}
