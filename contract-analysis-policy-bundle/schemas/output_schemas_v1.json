{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "APS Contract Analysis â€” Filled Template (v1)",
  "version": "1.0",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "SECTION_I": { "$ref": "#/$defs/ContractOverview" },
    "SECTION_II": { "type": "array", "items": { "$ref": "#/$defs/SectionItem" } },
    "SECTION_III": { "type": "array", "items": { "$ref": "#/$defs/SectionItem" } },
    "SECTION_IV": { "type": "array", "items": { "$ref": "#/$defs/SectionItem" } },
    "SECTION_V": { "type": "array", "items": { "$ref": "#/$defs/SectionItem" } },
    "SECTION_VI": { "type": "array", "items": { "$ref": "#/$defs/SectionItem" } },
    "SECTION_VII": { "type": "array", "items": { "$ref": "#/$defs/SupplementalRiskItem" } },
    "SECTION_VIII": { "$ref": "#/$defs/SectionVIII" },
    "OMISSION_CHECK": { "$ref": "#/$defs/OmissionCheck" },
    "doc_meta": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "policy_version": { "type": "string" },
        "created_at": { "type": "string" },
        "fdot_contract": { "type": ["boolean", "null"] },
        "fdot_year": { "type": ["string", "null"] }
      }
    }
  },
  "required": [
    "SECTION_I",
    "SECTION_II",
    "SECTION_III",
    "SECTION_IV",
    "SECTION_V",
    "SECTION_VI",
    "SECTION_VIII"
  ],
  "$defs": {
    "ClauseBlock": {
      "type": "object",
      "required": [
        "Clause Language",
        "Clause Summary",
        "Risk Triggers Identified",
        "Flow-Down Obligations",
        "Redline Recommendations",
        "Harmful Language / Policy Conflicts",
        "provenance"
      ],
      "properties": {
        "Clause Language": { "type": "string" },
        "Clause Summary": { "type": "string" },
        "Risk Triggers Identified": { "type": "string" },
        "Flow-Down Obligations": { "type": "string" },
        "Redline Recommendations": { "type": "string" },
        "Harmful Language / Policy Conflicts": { "type": "string" },
        "provenance": {
          "type": "object",
          "required": ["source", "page", "span"],
          "properties": {
            "source": { "type": "string" },
            "page": { "type": "integer" },
            "span": { "type": "string" }
          }
        }
      },
      "additionalProperties": false
    },
    "SectionItem": {
      "type": "object",
      "required": ["item_number", "item_title", "clauses", "closing_line"],
      "properties": {
        "item_number": { "type": "integer" },
        "item_title": { "type": "string" },
        "clauses": { "type": "array", "items": { "$ref": "#/$defs/ClauseBlock" } },
        "closing_line": {
          "type": "string",
          "pattern": "^All applicable clauses for .+ have been identified and analyzed\\.$"
        }
      },
      "additionalProperties": false
    },
    "SupplementalRiskItem": {
      "type": "object",
      "required": ["risk_title", "clauses", "sequence"],
      "properties": {
        "risk_title": { "type": "string" },
        "clauses": { "type": "array", "items": { "$ref": "#/$defs/ClauseBlock" } },
        "sequence": { "type": "string", "pattern": "^[0-9]+ of [0-9]+$" }
      },
      "additionalProperties": false
    },
    "RiskSummaryRow": {
      "type": "object",
      "required": ["Risk Area", "Risk Summary", "Redline Recommendation Summary"],
      "properties": {
        "Risk Area": { "type": "string" },
        "Risk Summary": { "type": "string" },
        "Redline Recommendation Summary": { "type": "string" }
      },
      "additionalProperties": false
    },
    "SectionVIII": {
      "type": "object",
      "required": ["rows", "general_risk_level"],
      "properties": {
        "rows": { "type": "array", "items": { "$ref": "#/$defs/RiskSummaryRow" } },
        "general_risk_level": { "type": "string" }
      },
      "additionalProperties": false
    },
    "ContractOverview": {
      "type": "object",
      "required": [
        "PROJECT TITLE:",
        "SOLICITATION NO.:",
        "OWNER:",
        "CONTRACTOR:",
        "SCOPE:",
        "GENERAL RISK LEVEL:",
        "BID MODEL:",
        "NOTES:"
      ],
      "properties": {
        "PROJECT TITLE:": { "type": "string" },
        "SOLICITATION NO.:": { "type": "string" },
        "OWNER:": { "type": "string" },
        "CONTRACTOR:": { "type": "string" },
        "SCOPE:": { "type": "string" },
        "GENERAL RISK LEVEL:": { "type": "string" },
        "BID MODEL:": { "type": "string" },
        "NOTES:": { "type": "string" }
      },
      "additionalProperties": false
    },
    "OmissionCheck": {
      "oneOf": [
        { "type": "string", "enum": ["No omissions or uncategorized risks identified."] },
        { "type": "array", "items": { "type": "object", "required": ["missed_clause", "suggested_section", "clause_block"], "properties": { "missed_clause": { "type": "string" }, "suggested_section": { "type": "string" }, "clause_block": { "$ref": "#/$defs/ClauseBlock" } }, "additionalProperties": false } }
      ]
    }
  }
}