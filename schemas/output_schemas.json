{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "APS Contract Analysis â€” Filled Template",
  "version": "2.0",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "section_i": { "$ref": "#/$defs/ContractOverview" },
    "section_ii": { "type": "array", "items": { "$ref": "#/$defs/SectionItem" } },
    "section_iii": { "type": "array", "items": { "$ref": "#/$defs/SectionItem" } },
    "section_iv": { "type": "array", "items": { "$ref": "#/$defs/SectionItem" } },
    "section_v": { "type": "array", "items": { "$ref": "#/$defs/SectionItem" } },
    "section_vi": { "type": "array", "items": { "$ref": "#/$defs/SectionItem" } },
    "doc_meta": {
      "type": "object",
      "additionalProperties": false,
      "required": ["schema_version", "created_at"],
      "properties": {
        "schema_version": { "type": "string" },
        "created_at": { "type": "string", "format": "date-time" },
        "generated_by": { "type": "string" },
        "fdot_contract": { "type": ["boolean", "null"] },
        "fdot_year": { "type": ["string", "null"] }
      }
    }
  },
  "required": [
    "section_i",
    "section_ii",
    "section_iii",
    "section_iv",
    "section_v",
    "section_vi",
    "doc_meta"
  ],
  "$defs": {
    "ClauseBlock": {
      "type": "object",
      "required": [
        "clause_language",
        "clause_summary",
        "risk_triggers",
        "flow_down_obligations",
        "redline_recommendations",
        "harmful_language"
      ],
      "properties": {
        "clause_language": { "type": "string", "minLength": 1 },
        "clause_summary": { "type": "string", "minLength": 1 },
        "risk_triggers": { "type": "string" },
        "flow_down_obligations": { "type": "string" },
        "redline_recommendations": { "type": "string" },
        "harmful_language": { "type": "string" },
        "provenance": {
          "type": "object",
          "required": ["source", "page", "span"],
          "properties": {
            "source": { "type": "string" },
            "page": { "type": "integer", "minimum": 1 },
            "span": { "type": "string" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "SectionItem": {
      "type": "object",
      "required": ["item_number", "item_title", "clauses", "closing_line"],
      "properties": {
        "item_number": { "type": "integer", "minimum": 1 },
        "item_title": { "type": "string", "minLength": 1 },
        "clauses": { 
          "type": "array", 
          "items": { "$ref": "#/$defs/ClauseBlock" },
          "minItems": 1
        },
        "closing_line": {
          "type": "string",
          "pattern": "^All applicable clauses for .+ have been identified and analyzed\\.$"
        }
      },
      "additionalProperties": false
    },
    "ContractOverview": {
      "type": "object",
      "required": [
        "project_title",
        "solicitation_no",
        "owner",
        "contractor",
        "scope",
        "general_risk_level",
        "bid_model",
        "notes"
      ],
      "properties": {
        "project_title": { "type": "string", "minLength": 1 },
        "solicitation_no": { "type": "string", "minLength": 1 },
        "owner": { "type": "string", "minLength": 1 },
        "contractor": { "type": "string", "minLength": 1 },
        "scope": { "type": "string", "minLength": 1 },
        "general_risk_level": { 
          "type": "string",
          "enum": ["Low", "Medium", "High", "Critical"]
        },
        "bid_model": { "type": "string", "minLength": 1 },
        "notes": { "type": "string" }
      },
      "additionalProperties": false
    }
  }
}
