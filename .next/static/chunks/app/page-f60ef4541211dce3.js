(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{860:(e,t,r)=>{"use strict";r.d(t,{default:()=>k});var n,o=r(5155),s=r(2115),l=s.forwardRef(function({control:e,...t},r){let n=s.useRef(null);return s.useLayoutEffect(()=>{let t=n.current;if(!t)return;if(customElements.get("openai-chatkit"))return void t.setOptions(e.options);let r=!0;return customElements.whenDefined("openai-chatkit").then(()=>{r&&t.setOptions(e.options)}),()=>{r=!1}},[e.options]),(0,o.jsx)("openai-chatkit",{ref:t=>{if(n.current=t,e.setInstance(t),"function"==typeof r?r(t):r&&(r.current=t),!n.current)return;let o={"chatkit.error":"onError","chatkit.response.end":"onResponseEnd","chatkit.response.start":"onResponseStart","chatkit.log":"onLog","chatkit.thread.change":"onThreadChange","chatkit.thread.load.start":"onThreadLoadStart","chatkit.thread.load.end":"onThreadLoadEnd"};for(let t of Object.keys(o))n.current.addEventListener(t,r=>{let n=e.handlers[o[t]];"function"==typeof n&&n(r.detail)})},...t})});function a(e){return null!==e&&"object"==typeof e&&[null,Object.prototype].includes(Object.getPrototypeOf(e))||Array.isArray(e)}var i=Object.freeze(["focusComposer","setThreadId","sendUserMessage","setComposerValue","fetchUpdates","sendCustomAction"]);let c=null!==(n="wf_690342befc00819090346c1c82ad3d620b47ddf27039e67e".trim())&&void 0!==n?n:"",u=[{label:"What can you do?",prompt:"What can you do?",icon:"circle-question"}];function f(e){let{error:t,fallbackMessage:r,onRetry:n,retryLabel:s}=e;if(!t&&!r)return null;let l=null!=t?t:r;return l?(0,o.jsx)("div",{className:"pointer-events-none absolute inset-0 z-10 flex h-full w-full flex-col justify-center rounded-[inherit] bg-white/85 p-6 text-center backdrop-blur dark:bg-slate-900/90",children:(0,o.jsxs)("div",{className:"pointer-events-auto mx-auto w-full max-w-md rounded-xl bg-white px-6 py-4 text-lg font-medium text-slate-700 dark:bg-transparent dark:text-slate-100",children:[(0,o.jsx)("div",{children:l}),t&&n?(0,o.jsx)("button",{type:"button",className:"mt-4 inline-flex items-center justify-center rounded-lg bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-none transition hover:bg-slate-800 focus:outline-none focus-visible:ring-2 focus-visible:ring-slate-500 focus-visible:ring-offset-2 dark:bg-slate-100 dark:text-slate-900 dark:hover:bg-slate-200",onClick:n,children:null!=s?s:"Restart chat"}):null]})}):null}let d=()=>({script:null,session:null,integration:null,retryable:!1});function h(e){var t,r;let{theme:n,onWidgetAction:h,onResponseEnd:p,onThemeRequest:m}=e,y=(0,s.useRef)(new Set),[g,b]=(0,s.useState)(()=>d()),[w,k]=(0,s.useState)(!0),v=(0,s.useRef)(!0),[E,x]=(0,s.useState)(()=>{var e;return(null==(e=window.customElements)?void 0:e.get("openai-chatkit"))?"ready":"pending"}),[C,j]=(0,s.useState)(0),S=(0,s.useCallback)(e=>{b(t=>({...t,...e}))},[]);(0,s.useEffect)(()=>()=>{v.current=!1},[]),(0,s.useEffect)(()=>{var e;let t,r=()=>{v.current&&(x("ready"),S({script:null}))},n=e=>{var t;if(console.error("Failed to load chatkit.js for some reason",e),!v.current)return;x("error");let r=null!=(t=null==e?void 0:e.detail)?t:"unknown error";S({script:"Error: ".concat(r),retryable:!1}),k(!1)};return window.addEventListener("chatkit-script-loaded",r),window.addEventListener("chatkit-script-error",n),(null==(e=window.customElements)?void 0:e.get("openai-chatkit"))?r():"pending"===E&&(t=window.setTimeout(()=>{var e;(null==(e=window.customElements)?void 0:e.get("openai-chatkit"))||n(new CustomEvent("chatkit-script-error",{detail:"ChatKit web component is unavailable. Verify that the script URL is reachable."}))},5e3)),()=>{window.removeEventListener("chatkit-script-loaded",r),window.removeEventListener("chatkit-script-error",n),t&&window.clearTimeout(t)}},[E,S]);let _=!!(c&&!c.startsWith("wf_replace"));(0,s.useEffect)(()=>{!_&&v.current&&(S({session:"Set NEXT_PUBLIC_CHATKIT_WORKFLOW_ID in your .env.local file.",retryable:!1}),k(!1))},[_,S]);let L=(0,s.useCallback)(()=>{var e;y.current.clear(),x((null==(e=window.customElements)?void 0:e.get("openai-chatkit"))?"ready":"pending"),k(!0),b(d()),j(e=>e+1)},[]),O=function(e){let t=s.useRef(null),r=function(e){let t=s.useRef(e);t.current=e;let r=s.useRef(null);return r.current&&function e(t,r,n=new WeakMap){if(Object.is(t,r))return!0;if("function"==typeof t&&"function"==typeof r)return typeof t==typeof r;if(!a(t)||!a(r))return!1;let o=n.get(t);if(o&&o===r)return!0;if(n.set(t,r),Array.isArray(t)||Array.isArray(r)){if(!Array.isArray(t)||!Array.isArray(r)||t.length!==r.length)return!1;for(let o=0;o<t.length;o++)if(!e(t[o],r[o],n))return!1;return!0}let s=Object.keys(t),l=Object.keys(r);if(s.length!==l.length)return!1;for(let o=0;o<s.length;o++){let l=s[o];if(!Object.prototype.hasOwnProperty.call(r,l)||!e(t[l],r[l],n))return!1}return!0}(r.current.snapshot,e)||(r.current={snapshot:e,shaped:function(e){let t=[],r=n=>{if("function"==typeof n){let r,n=t[t.length-1];return r=t.slice(0,-1),(...t)=>{let o,s=(o=e.current,r.reduce((e,t)=>null==e?e:e[t],o)),l=s?.[n];if("function"==typeof l)return l.apply(s,t)}}if(Array.isArray(n)){let e=t.length,o=Array(n.length);for(let s=0;s<n.length;s++)t[e]=s,o[s]=r(n[s]);return t.length=e,o}if(n&&"object"==typeof n){let e=t.length,o={};for(let s of Object.keys(n))t[e]=s,o[s]=r(n[s]);return t.length=e,o}return n};return r(e.current)}(t)}),r.current.shaped}(e),n=s.useMemo(()=>i.reduce((e,r)=>(e[r]=(...e)=>t.current?t.current[r](...e):void console.warn("ChatKit element is not mounted"),e),{}),[]),o=s.useCallback(e=>{t.current=e},[]),l=s.useMemo(()=>{let e={},t={};for(let[n,o]of Object.entries(r))/^on[A-Z]/.test(n)&&"onClientTool"!==n?t[n]=o:e[n]=o;return{setInstance:o,options:e,handlers:t}},[r,o]);return s.useMemo(()=>({...n,control:l,ref:t}),[n,l])}({api:{getClientSecret:(0,s.useCallback)(async e=>{if(!_){let e="Set NEXT_PUBLIC_CHATKIT_WORKFLOW_ID in your .env.local file.";throw v.current&&(S({session:e,retryable:!1}),k(!1)),Error(e)}v.current&&(e||k(!0),S({session:null,integration:null,retryable:!1}));try{let e=await fetch("/api/create-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({workflow:{id:c},chatkit_configuration:{file_upload:{enabled:!0}}})}),t=await e.text(),r={};if(t)try{r=JSON.parse(t)}catch(e){console.error("Failed to parse create-session response",e)}if(!e.ok){let t=function(e,t){if(!e)return t;let r=e.error;if("string"==typeof r)return r;if(r&&"object"==typeof r&&"message"in r&&"string"==typeof r.message)return r.message;let n=e.details;if("string"==typeof n)return n;if(n&&"object"==typeof n&&"error"in n){let e=n.error;if("string"==typeof e)return e;if(e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message)return e.message}return"string"==typeof e.message?e.message:t}(r,e.statusText);throw console.error("Create session request failed",{status:e.status,body:r}),Error(t)}let n=null==r?void 0:r.client_secret;if(!n)throw Error("Missing client secret in response");return v.current&&S({session:null,integration:null}),n}catch(t){console.error("Failed to create ChatKit session",t);let e=t instanceof Error?t.message:"Unable to start ChatKit session.";throw v.current&&S({session:e,retryable:!1}),t instanceof Error?t:Error(e)}finally{v.current&&!e&&k(!1)}},[_,S])},theme:{colorScheme:n,color:{grayscale:{hue:220,tint:6,shade:"dark"===n?-1:-4},accent:{primary:"dark"===n?"#f1f5f9":"#0f172a",level:1}},radius:"round"},startScreen:{greeting:"How can I help you today?",prompts:u},composer:{placeholder:"Ask anything...",attachments:{enabled:!0}},threadItemActions:{feedback:!1},onClientTool:async e=>{if(console.log("[onClientTool]",e.name,e.params),"download_pdf_from_html"===e.name)return{success:!0};if("switch_theme"===e.name){let t=e.params.theme;return"light"===t||"dark"===t?(m(t),{success:!0}):{success:!1}}if("record_fact"===e.name){var t,r;let n=String(null!=(t=e.params.fact_id)?t:""),o=String(null!=(r=e.params.fact_text)?r:"");return!n||y.current.has(n)||(y.current.add(n),h({type:"save",factId:n,factText:o.replace(/\s+/g," ").trim()})),{success:!0}}return{success:!1}},onResponseEnd:()=>{p()},onResponseStart:()=>{S({integration:null,retryable:!1})},onThreadChange:()=>{y.current.clear()},onError:e=>{let{error:t}=e;console.error("ChatKit error",t)}}),T=null!=(t=g.session)?t:g.integration,A=null!=(r=g.script)?r:T;return(0,o.jsxs)("div",{className:"relative pb-8 flex h-[90vh] w-full rounded-2xl flex-col overflow-hidden bg-white shadow-sm transition-colors dark:bg-slate-900",children:[(0,o.jsx)(l,{control:O.control,className:A||w?"pointer-events-none opacity-0":"block h-full w-full"},C),(0,o.jsx)(f,{error:A,fallbackMessage:A||!w?null:"Loading assistant session...",onRetry:A&&g.retryable?L:null,retryLabel:"Restart chat"})]})}let p="chatkit-color-scheme";function m(){if("function"!=typeof window.matchMedia)return null;try{return window.matchMedia("(prefers-color-scheme: dark)")}catch(e){return null}}function y(){let e=m();return(null==e?void 0:e.matches)?"dark":"light"}function g(){return"light"}function b(e){let t=m();if(!t)return()=>{};let r=()=>e();return"function"==typeof t.addEventListener?(t.addEventListener("change",r),()=>t.removeEventListener("change",r)):"function"==typeof t.addListener?(t.addListener(r),()=>t.removeListener(r)):()=>{}}function w(){try{let e=window.localStorage.getItem(p);if("light"===e||"dark"===e)return e;return"system"===e?"system":null}catch(e){return null}}function k(){let{scheme:e,setScheme:t}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"system",t=(0,s.useSyncExternalStore)(b,y,g),[r,n]=(0,s.useState)(()=>{var t;return null!=(t=w())?t:e}),o=(0,s.useMemo)(()=>"system"===r?t:r,[r,t]);(0,s.useEffect)(()=>{try{"system"===r?window.localStorage.removeItem(p):window.localStorage.setItem(p,r)}catch(e){}},[r]),(0,s.useEffect)(()=>{!function(e){if("undefined"==typeof document)return;let t=document.documentElement;t.dataset.colorScheme=e,t.classList.toggle("dark","dark"===e),t.style.colorScheme=e}(o)},[o]),(0,s.useEffect)(()=>{let e=e=>{e.key===p&&n(e=>{let t=w();return null!=t?t:e})};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]);let l=(0,s.useCallback)(e=>{n(e)},[]);return{scheme:o,preference:r,setScheme:(0,s.useCallback)(e=>{n(e)},[]),setPreference:l,resetPreference:(0,s.useCallback)(()=>{n("system")},[])}}(),r=(0,s.useCallback)(async e=>{},[]),n=(0,s.useCallback)(()=>{},[]);return(0,o.jsx)("main",{className:"flex min-h-screen flex-col items-center justify-end bg-slate-100 dark:bg-slate-950",children:(0,o.jsx)("div",{className:"mx-auto w-full max-w-5xl",children:(0,o.jsx)(h,{theme:e,onWidgetAction:r,onResponseEnd:n,onThemeRequest:t})})})}},4363:(e,t,r)=>{Promise.resolve().then(r.bind(r,860))}},e=>{e.O(0,[441,255,358],()=>e(e.s=4363)),_N_E=e.O()}]);