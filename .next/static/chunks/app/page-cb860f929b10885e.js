(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{860:(e,t,r)=>{"use strict";r.d(t,{default:()=>x});var n,s=r(5155),o=r(2115),l=o.forwardRef(function({control:e,...t},r){let n=o.useRef(null);return o.useLayoutEffect(()=>{let t=n.current;if(!t)return;if(customElements.get("openai-chatkit"))return void t.setOptions(e.options);let r=!0;return customElements.whenDefined("openai-chatkit").then(()=>{r&&t.setOptions(e.options)}),()=>{r=!1}},[e.options]),(0,s.jsx)("openai-chatkit",{ref:t=>{if(n.current=t,e.setInstance(t),"function"==typeof r?r(t):r&&(r.current=t),!n.current)return;let s={"chatkit.error":"onError","chatkit.response.end":"onResponseEnd","chatkit.response.start":"onResponseStart","chatkit.log":"onLog","chatkit.thread.change":"onThreadChange","chatkit.thread.load.start":"onThreadLoadStart","chatkit.thread.load.end":"onThreadLoadEnd"};for(let t of Object.keys(s))n.current.addEventListener(t,r=>{let n=e.handlers[s[t]];"function"==typeof n&&n(r.detail)})},...t})});function a(e){return null!==e&&"object"==typeof e&&[null,Object.prototype].includes(Object.getPrototypeOf(e))||Array.isArray(e)}var i=Object.freeze(["focusComposer","setThreadId","sendUserMessage","setComposerValue","fetchUpdates","sendCustomAction"]);let c=null!==(n="wf_690342befc00819090346c1c82ad3d620b47ddf27039e67e".trim())&&void 0!==n?n:"",u=[{label:"What can you do?",prompt:"What can you do?",icon:"circle-question"}];function d(e){let{error:t,fallbackMessage:r,onRetry:n,retryLabel:o}=e;if(!t&&!r)return null;let l=null!=t?t:r;return l?(0,s.jsx)("div",{className:"pointer-events-none absolute inset-0 z-10 flex h-full w-full flex-col justify-center rounded-[inherit] bg-white/85 p-6 text-center backdrop-blur dark:bg-slate-900/90",children:(0,s.jsxs)("div",{className:"pointer-events-auto mx-auto w-full max-w-md rounded-xl bg-white px-6 py-4 text-lg font-medium text-slate-700 dark:bg-transparent dark:text-slate-100",children:[(0,s.jsx)("div",{children:l}),t&&n?(0,s.jsx)("button",{type:"button",className:"mt-4 inline-flex items-center justify-center rounded-lg bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-none transition hover:bg-slate-800 focus:outline-none focus-visible:ring-2 focus-visible:ring-slate-500 focus-visible:ring-offset-2 dark:bg-slate-100 dark:text-slate-900 dark:hover:bg-slate-200",onClick:n,children:null!=o?o:"Restart chat"}):null]})}):null}let f=null;async function h(){return f||(f=await Promise.all([r.e(33),r.e(930),r.e(628),r.e(316),r.e(241)]).then(r.t.bind(r,9589,23))),f.default}async function p(e,t){let r=document.createElement("div");r.style.position="fixed",r.style.left="-99999px",r.style.top="0",r.style.width="800px",r.innerHTML=e,document.body.appendChild(r);try{let e=await h();await e().set({filename:t,margin:10,image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"pt",format:"a4",orientation:"portrait"}}).from(r).save()}finally{document.body.removeChild(r)}}let m=()=>({script:null,session:null,integration:null,retryable:!1});function y(e){var t,r;let{theme:n,onWidgetAction:f,onResponseEnd:h,onThemeRequest:y}=e,g=(0,o.useRef)(new Set),[w,b]=(0,o.useState)(()=>m()),[k,v]=(0,o.useState)(!0),E=(0,o.useRef)(!0),[x,C]=(0,o.useState)(()=>{var e;return(null==(e=window.customElements)?void 0:e.get("openai-chatkit"))?"ready":"pending"}),[j,S]=(0,o.useState)(0),L=(0,o.useCallback)(e=>{b(t=>({...t,...e}))},[]);(0,o.useEffect)(()=>()=>{E.current=!1},[]),(0,o.useEffect)(()=>{var e;let t,r=()=>{E.current&&(C("ready"),L({script:null}))},n=e=>{var t;if(console.error("Failed to load chatkit.js for some reason",e),!E.current)return;C("error");let r=null!=(t=null==e?void 0:e.detail)?t:"unknown error";L({script:"Error: ".concat(r),retryable:!1}),v(!1)};return window.addEventListener("chatkit-script-loaded",r),window.addEventListener("chatkit-script-error",n),(null==(e=window.customElements)?void 0:e.get("openai-chatkit"))?r():"pending"===x&&(t=window.setTimeout(()=>{var e;(null==(e=window.customElements)?void 0:e.get("openai-chatkit"))||n(new CustomEvent("chatkit-script-error",{detail:"ChatKit web component is unavailable. Verify that the script URL is reachable."}))},5e3)),()=>{window.removeEventListener("chatkit-script-loaded",r),window.removeEventListener("chatkit-script-error",n),t&&window.clearTimeout(t)}},[x,L]);let _=!!(c&&!c.startsWith("wf_replace"));(0,o.useEffect)(()=>{!_&&E.current&&(L({session:"Set NEXT_PUBLIC_CHATKIT_WORKFLOW_ID in your .env.local file.",retryable:!1}),v(!1))},[_,L]);let O=(0,o.useCallback)(()=>{var e;g.current.clear(),C((null==(e=window.customElements)?void 0:e.get("openai-chatkit"))?"ready":"pending"),v(!0),b(m()),S(e=>e+1)},[]),A=function(e){let t=o.useRef(null),r=function(e){let t=o.useRef(e);t.current=e;let r=o.useRef(null);return r.current&&function e(t,r,n=new WeakMap){if(Object.is(t,r))return!0;if("function"==typeof t&&"function"==typeof r)return typeof t==typeof r;if(!a(t)||!a(r))return!1;let s=n.get(t);if(s&&s===r)return!0;if(n.set(t,r),Array.isArray(t)||Array.isArray(r)){if(!Array.isArray(t)||!Array.isArray(r)||t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(!e(t[s],r[s],n))return!1;return!0}let o=Object.keys(t),l=Object.keys(r);if(o.length!==l.length)return!1;for(let s=0;s<o.length;s++){let l=o[s];if(!Object.prototype.hasOwnProperty.call(r,l)||!e(t[l],r[l],n))return!1}return!0}(r.current.snapshot,e)||(r.current={snapshot:e,shaped:function(e){let t=[],r=n=>{if("function"==typeof n){let r,n=t[t.length-1];return r=t.slice(0,-1),(...t)=>{let s,o=(s=e.current,r.reduce((e,t)=>null==e?e:e[t],s)),l=o?.[n];if("function"==typeof l)return l.apply(o,t)}}if(Array.isArray(n)){let e=t.length,s=Array(n.length);for(let o=0;o<n.length;o++)t[e]=o,s[o]=r(n[o]);return t.length=e,s}if(n&&"object"==typeof n){let e=t.length,s={};for(let o of Object.keys(n))t[e]=o,s[o]=r(n[o]);return t.length=e,s}return n};return r(e.current)}(t)}),r.current.shaped}(e),n=o.useMemo(()=>i.reduce((e,r)=>(e[r]=(...e)=>t.current?t.current[r](...e):void console.warn("ChatKit element is not mounted"),e),{}),[]),s=o.useCallback(e=>{t.current=e},[]),l=o.useMemo(()=>{let e={},t={};for(let[n,s]of Object.entries(r))/^on[A-Z]/.test(n)&&"onClientTool"!==n?t[n]=s:e[n]=s;return{setInstance:s,options:e,handlers:t}},[r,s]);return o.useMemo(()=>({...n,control:l,ref:t}),[n,l])}({api:{getClientSecret:(0,o.useCallback)(async e=>{if(!_){let e="Set NEXT_PUBLIC_CHATKIT_WORKFLOW_ID in your .env.local file.";throw E.current&&(L({session:e,retryable:!1}),v(!1)),Error(e)}E.current&&(e||v(!0),L({session:null,integration:null,retryable:!1}));try{let e=await fetch("/api/create-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({workflow:{id:c},chatkit_configuration:{file_upload:{enabled:!0}}})}),t=await e.text(),r={};if(t)try{r=JSON.parse(t)}catch(e){console.error("Failed to parse create-session response",e)}if(!e.ok){let t=function(e,t){if(!e)return t;let r=e.error;if("string"==typeof r)return r;if(r&&"object"==typeof r&&"message"in r&&"string"==typeof r.message)return r.message;let n=e.details;if("string"==typeof n)return n;if(n&&"object"==typeof n&&"error"in n){let e=n.error;if("string"==typeof e)return e;if(e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message)return e.message}return"string"==typeof e.message?e.message:t}(r,e.statusText);throw console.error("Create session request failed",{status:e.status,body:r}),Error(t)}let n=null==r?void 0:r.client_secret;if(!n)throw Error("Missing client secret in response");return E.current&&L({session:null,integration:null}),n}catch(t){console.error("Failed to create ChatKit session",t);let e=t instanceof Error?t.message:"Unable to start ChatKit session.";throw E.current&&L({session:e,retryable:!1}),t instanceof Error?t:Error(e)}finally{E.current&&!e&&v(!1)}},[_,L])},theme:{colorScheme:n,color:{grayscale:{hue:220,tint:6,shade:"dark"===n?-1:-4},accent:{primary:"dark"===n?"#f1f5f9":"#0f172a",level:1}},radius:"round"},startScreen:{greeting:"How can I help you today?",prompts:u},composer:{placeholder:"Ask anything...",attachments:{enabled:!0}},threadItemActions:{feedback:!1},onClientTool:async e=>{var t,r,n,s;if("download_pdf_from_html"===e.name){let n=String(null!=(t=e.params.html)?t:""),s=null!=(r=e.params.filename)?r:"CR2A-report.pdf";return n?(await p(n,s),{success:!0}):{success:!1}}if("switch_theme"===e.name){let t=e.params.theme;return"light"===t||"dark"===t?(y(t),{success:!0}):{success:!1}}if("record_fact"===e.name){let t=String(null!=(n=e.params.fact_id)?n:""),r=String(null!=(s=e.params.fact_text)?s:"");return!t||g.current.has(t)||(g.current.add(t),f({type:"save",factId:t,factText:r.replace(/\s+/g," ").trim()})),{success:!0}}return{success:!1}},onResponseEnd:()=>{h()},onResponseStart:()=>{L({integration:null,retryable:!1})},onThreadChange:()=>{g.current.clear()},onError:e=>{let{error:t}=e;console.error("ChatKit error",t)}}),T=null!=(t=w.session)?t:w.integration,R=null!=(r=w.script)?r:T;return(0,s.jsxs)("div",{className:"relative pb-8 flex h-[90vh] w-full rounded-2xl flex-col overflow-hidden bg-white shadow-sm transition-colors dark:bg-slate-900",children:[(0,s.jsx)(l,{control:A.control,className:R||k?"pointer-events-none opacity-0":"block h-full w-full"},j),(0,s.jsx)(d,{error:R,fallbackMessage:R||!k?null:"Loading assistant session...",onRetry:R&&w.retryable?O:null,retryLabel:"Restart chat"})]})}let g="chatkit-color-scheme";function w(){if("function"!=typeof window.matchMedia)return null;try{return window.matchMedia("(prefers-color-scheme: dark)")}catch(e){return null}}function b(){let e=w();return(null==e?void 0:e.matches)?"dark":"light"}function k(){return"light"}function v(e){let t=w();if(!t)return()=>{};let r=()=>e();return"function"==typeof t.addEventListener?(t.addEventListener("change",r),()=>t.removeEventListener("change",r)):"function"==typeof t.addListener?(t.addListener(r),()=>t.removeListener(r)):()=>{}}function E(){try{let e=window.localStorage.getItem(g);if("light"===e||"dark"===e)return e;return"system"===e?"system":null}catch(e){return null}}function x(){let{scheme:e,setScheme:t}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"system",t=(0,o.useSyncExternalStore)(v,b,k),[r,n]=(0,o.useState)(()=>{var t;return null!=(t=E())?t:e}),s=(0,o.useMemo)(()=>"system"===r?t:r,[r,t]);(0,o.useEffect)(()=>{try{"system"===r?window.localStorage.removeItem(g):window.localStorage.setItem(g,r)}catch(e){}},[r]),(0,o.useEffect)(()=>{!function(e){if("undefined"==typeof document)return;let t=document.documentElement;t.dataset.colorScheme=e,t.classList.toggle("dark","dark"===e),t.style.colorScheme=e}(s)},[s]),(0,o.useEffect)(()=>{let e=e=>{e.key===g&&n(e=>{let t=E();return null!=t?t:e})};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]);let l=(0,o.useCallback)(e=>{n(e)},[]);return{scheme:s,preference:r,setScheme:(0,o.useCallback)(e=>{n(e)},[]),setPreference:l,resetPreference:(0,o.useCallback)(()=>{n("system")},[])}}(),r=(0,o.useCallback)(async e=>{},[]),n=(0,o.useCallback)(()=>{},[]);return(0,s.jsx)("main",{className:"flex min-h-screen flex-col items-center justify-end bg-slate-100 dark:bg-slate-950",children:(0,s.jsx)("div",{className:"mx-auto w-full max-w-5xl",children:(0,s.jsx)(y,{theme:e,onWidgetAction:r,onResponseEnd:n,onThemeRequest:t})})})}},4363:(e,t,r)=>{Promise.resolve().then(r.bind(r,860))}},e=>{e.O(0,[441,255,358],()=>e(e.s=4363)),_N_E=e.O()}]);