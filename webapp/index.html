<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CR2A | Clause Risk & Compliance Analyzer</title>
  <link rel="icon" href="about:blank" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <!-- ===== HEADER ===== -->
  <header class="app-header">
    <div class="header-container">
      <div class="header-brand">
        <div class="company-logo">APS</div>
        <div class="company-info">
          <p class="company-name">Atlantic Pipe Services</p>
          <p class="app-name">CR2A</p>
        </div>
      </div>
      <div class="header-actions">
        <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">ðŸŒ™ Dark</button>
      </div>
    </div>
  </header>

  <!-- ===== BREADCRUMB ===== -->
  <div class="breadcrumb-container">
    <div class="breadcrumb">
      <span class="breadcrumb-item">Analyzer</span>
    </div>
  </div>

  <!-- ===== MAIN CONTENT ===== -->
  <div class="page">
    <!-- ===== HERO SECTION ===== -->
    <section class="hero">
      <div class="brand">
        <div>
          <p class="eyebrow">Contract Risk Analysis</p>
          <h1>Clause Risk & Compliance Analyzer</h1>
          <p class="lede">
            Upload a contract and analyze potential risks and compliance issues. Streamlined intake for FDOT and internal contracts with executive-ready outputs.
          </p>
        </div>
      </div>

      <!-- ===== SUBMISSION CARD ===== -->
      <div class="hero-card">
        <div class="hero-title">
          <div>
            <p class="eyebrow">Start Analysis</p>
            <h3>Submit Contract</h3>
          </div>
          <span class="pill">Ready to begin</span>
        </div>
        <form id="submission-form" novalidate>
          <!-- Contract ID Field -->
          <div class="field">
            <label for="contract-id">
              Contract ID
              <span class="required" aria-label="required">*</span>
            </label>
            <input 
              type="text" 
              id="contract-id"
              name="contract_id" 
              placeholder="e.g., FDOT-Bridge-2024-18" 
              required
              aria-describedby="contract-id-help"
            />
            <p class="field-help" id="contract-id-help">A unique identifier for tracking</p>
            <p class="field-error">Please enter a valid contract ID</p>
          </div>

          <!-- Contract File Field -->
          <div class="field">
            <label for="file-input">
              Contract File
              <span class="required" aria-label="required">*</span>
            </label>
            <label class="dropzone" id="dropzone" aria-describedby="file-help">
              <input type="file" id="file-input" name="contract_file" accept=".pdf,.doc,.docx,.txt" required />
              <div>
                <p class="drop-title">ðŸ“„ Drop contract or click to browse</p>
                <p class="drop-sub">PDF, DOCX, or TXT files up to 500 MB</p>
                <div id="file-name" class="file-name">No file selected</div>
              </div>
            </label>
            <p class="field-help" id="file-help">Supported formats: PDF, DOCX, TXT. File will be analyzed and stored securely.</p>
            <p class="field-error">Please select a valid contract file</p>
          </div>

          <!-- Upload Progress -->
          <div class="upload-status">
            <div class="progress" id="upload-progress" hidden>
              <div class="progress-bar" id="upload-progress-bar"></div>
              <span id="upload-progress-text">0%</span>
            </div>
            <p id="upload-message" class="meta"></p>
          </div>

          <!-- Submit Button -->
          <button type="submit" class="btn primary full" id="submit-btn">Analyze Contract</button>
        </form>
      </div>
    </section>

    <!-- ===== MAIN CONTENT ===== -->
    <main class="content">
      <!-- ===== TIMELINE SECTION ===== -->
      <section class="panel">
        <div class="panel-header">
          <div>
            <p class="eyebrow">Processing</p>
            <h3>Analysis Timeline</h3>
          </div>
          <span class="pill soft">Live Updates</span>
        </div>
        <div class="timeline" id="timeline">
          <div class="timeline-row">
            <div class="dot active"></div>
            <div>
              <p class="title">Ready for submission</p>
              <p class="meta">Upload a contract and configure settings to begin analysis</p>
            </div>
          </div>
        </div>
      </section>

      <!-- ===== RESULTS SECTION ===== -->
      <section class="panel grid">
        <div>
          <div class="panel-header">
            <div>
              <p class="eyebrow">Results</p>
              <h3>Analysis Output</h3>
            </div>
            <span class="pill soft">Pending</span>
          </div>
          <div class="output">
            <div class="output-row">
              <span class="output-label">Analysis Status</span>
              <span class="output-value" id="validation-status">
                <span>Pending</span>
              </span>
            </div>
            <div class="output-row">
              <span class="output-label">Risk Level</span>
              <span class="output-value" id="risk-level">â€”</span>
            </div>
            <div class="output-row">
              <span class="output-label">Findings Found</span>
              <span class="output-value" id="findings-count">0</span>
            </div>
            <div class="output-row">
              <span class="output-label">Report Status</span>
              <span class="output-value" id="export-status">Pending</span>
            </div>
            <div class="output-row output-action">
              <span class="output-label">Download Report</span>
              <a id="download-report" class="btn small" href="#" aria-disabled="true">Get Report</a>
            </div>
          </div>
        </div>

        <!-- ===== INSIGHTS SIDEBAR ===== -->
        <aside class="insights-sidebar">
          <div class="insight">
            <h4>About CR2A</h4>
            <ul>
              <li>Automated contract analysis</li>
              <li>Risk identification and scoring</li>
              <li>Compliance validation</li>
              <li>Executive summaries</li>
              <li>Secure PDF export</li>
            </ul>
          </div>
          <div class="insight">
            <h4>Processing Steps</h4>
            <ul>
              <li>File validation</li>
              <li>OCR extraction (if needed)</li>
              <li>Risk assessment</li>
              <li>Compliance check</li>
              <li>Report generation</li>
            </ul>
          </div>
        </aside>
      </section>
    </main>

    <!-- ===== FOOTER ===== -->
    <footer class="footer">
      <p>&copy; 2024 Atlantic Pipe Services. CR2A Contract Analysis Platform.</p>
    </footer>
  </div>

  <!-- ===== NOTIFICATION CONTAINER ===== -->
  <div id="notifications"></div>

  <!-- ===== SCRIPTS ===== -->
  <script src="./env.js"></script>
  <script type="module" src="./app.js"></script>
  
  <!-- ===== DARK MODE & UTILITY SCRIPT ===== -->
  <script>
    // Dark Mode Toggle
    const themeToggle = document.getElementById('theme-toggle');
    const htmlElement = document.documentElement;
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    
    // Initialize theme from localStorage or system preference
    const savedTheme = localStorage.getItem('theme') || (prefersDark ? 'dark' : 'light');
    if (savedTheme === 'dark') {
      htmlElement.setAttribute('data-theme', 'dark');
      themeToggle.textContent = 'â˜€ï¸ Light';
    }
    
    themeToggle.addEventListener('click', () => {
      const currentTheme = htmlElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      htmlElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      themeToggle.textContent = newTheme === 'dark' ? 'â˜€ï¸ Light' : 'ðŸŒ™ Dark';
    });

    // Form Validation
    const form = document.getElementById('submission-form');
    const formInputs = form.querySelectorAll('input[required], textarea[required]');
    
    formInputs.forEach(input => {
      input.addEventListener('blur', validateField);
      input.addEventListener('change', validateField);
    });
    
    function validateField(e) {
      const field = e.target.closest('.field');
      const isValid = e.target.checkValidity();
      
      if (isValid) {
        field.classList.remove('error');
      } else if (e.target.value) {
        field.classList.add('error');
      }
    }

    // Notification System
    function showNotification(message, type = 'info') {
      const container = document.getElementById('notifications');
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      notification.setAttribute('role', 'alert');
      container.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 4000);
    }

    // Export notification helper to window for app.js
    window.showNotification = showNotification;
  </script>
</body>
</html>